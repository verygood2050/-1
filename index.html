<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“– ì„±ê²½ ì•”ì†¡ ì¹´ë“œ</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .scroll-container::-webkit-scrollbar { width: 12px; }
    .scroll-container::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
    .scroll-container::-webkit-scrollbar-thumb { background: #a855f7; border-radius: 10px; }
    .scroll-container::-webkit-scrollbar-thumb:hover { background: #9333ea; }
    
    .search-scroll::-webkit-scrollbar { width: 12px; }
    .search-scroll::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
    .search-scroll::-webkit-scrollbar-thumb { background: #14b8a6; border-radius: 10px; }
    .search-scroll::-webkit-scrollbar-thumb:hover { background: #0d9488; }
    
    .stats-scroll::-webkit-scrollbar { width: 12px; }
    .stats-scroll::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
    .stats-scroll::-webkit-scrollbar-thumb { background: #a855f7; border-radius: 10px; }
    .stats-scroll::-webkit-scrollbar-thumb:hover { background: #9333ea; }
    
    .verse-scroll::-webkit-scrollbar { width: 12px; }
    .verse-scroll::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
    .verse-scroll::-webkit-scrollbar-thumb { background: #a855f7; border-radius: 10px; }
    .verse-scroll::-webkit-scrollbar-thumb:hover { background: #9333ea; }
    
    .delete-scroll::-webkit-scrollbar { width: 12px; }
    .delete-scroll::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
    .delete-scroll::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 10px; }
    .delete-scroll::-webkit-scrollbar-thumb:hover { background: #dc2626; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ë“¤
    const Upload = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
    );
    
    const X = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );
    
    const Download = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
    );
    
    const Search = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
    );
    
    const BarChart3 = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/>
      </svg>
    );
    
    const Shuffle = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/>
      </svg>
    );
    
    const RotateCcw = ({ className }) => (
      <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>
      </svg>
    );

    const BibleMemoryCards = () => {
      const generateEmptyData = () => {
        const data = {};
        data['001'] = { reference: 'ì°½ì„¸ê¸° 1:1,31', text: 'íƒœì´ˆì— í•˜ë‚˜ë‹˜ì´ ì²œì§€ë¥¼ ì°½ì¡°í•˜ì‹œë‹ˆë¼ í•˜ë‚˜ë‹˜ì´ ì§€ìœ¼ì‹  ê·¸ ëª¨ë“  ê²ƒì„ ë³´ì‹œë‹ˆ ë³´ì‹œê¸°ì— ì‹¬íˆ ì¢‹ì•˜ë”ë¼ ì €ë…ì´ ë˜ê³  ì•„ì¹¨ì´ ë˜ë‹ˆ ì´ëŠ” ì—¬ì„¯ì§¸ ë‚ ì´ë‹ˆë¼' };
        data['002'] = { reference: 'ì ì–¸ 16:9', text: 'ì‚¬ëŒì´ ë§ˆìŒìœ¼ë¡œ ìê¸°ì˜ ê¸¸ì„ ê³„íší• ì§€ë¼ë„ ê·¸ì˜ ê±¸ìŒì„ ì¸ë„í•˜ì‹œëŠ” ì´ëŠ” ì—¬í˜¸ì™€ì‹œë‹ˆë¼' };
        data['003'] = { reference: 'ìš”í•œë³µìŒ 13:34', text: 'ìƒˆ ê³„ëª…ì„ ë„ˆí¬ì—ê²Œ ì£¼ë…¸ë‹ˆ ì„œë¡œ ì‚¬ë‘í•˜ë¼ ë‚´ê°€ ë„ˆí¬ë¥¼ ì‚¬ë‘í•œ ê²ƒ ê°™ì´ ë„ˆí¬ë„ ì„œë¡œ ì‚¬ë‘í•˜ë¼' };
        data['004'] = { reference: 'ëˆ„ê°€ë³µìŒ 17:6', text: 'ì£¼ê»˜ì„œ ì´ë¥´ì‹œë˜ ë„ˆí¬ì—ê²Œ ê²¨ìì”¨ í•œ ì•Œë§Œí•œ ë¯¿ìŒì´ ìˆì—ˆë”ë¼ë©´ ì´ ë½•ë‚˜ë¬´ë”ëŸ¬ ë¿Œë¦¬ê°€ ë½‘í˜€ ë°”ë‹¤ì— ì‹¬ê²¨ì§€ë¼ í•˜ì˜€ì„ ê²ƒì´ìš” ê·¸ê²ƒì´ ë„ˆí¬ì—ê²Œ ìˆœì¢…í•˜ì˜€ìœ¼ë¦¬ë¼' };
        data['005'] = { reference: 'ìš”í•œë³µìŒ 11:25', text: 'ì˜ˆìˆ˜ê»˜ì„œ ì´ë¥´ì‹œë˜ ë‚˜ëŠ” ë¶€í™œì´ìš” ìƒëª…ì´ë‹ˆ ë‚˜ë¥¼ ë¯¿ëŠ” ìëŠ” ì£½ì–´ë„ ì‚´ê² ê³ ' };
        data['006'] = { reference: 'ëˆ„ê°€ë³µìŒ 10:36', text: 'ë„¤ ìƒê°ì—ëŠ” ì´ ì„¸ ì‚¬ëŒ ì¤‘ì— ëˆ„ê°€ ê°•ë„ ë§Œë‚œ ìì˜ ì´ì›ƒì´ ë˜ê² ëŠëƒ' };
        data['007'] = { reference: 'ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16~18', text: 'í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼ ì´ê²ƒì´ ê·¸ë¦¬ìŠ¤ë„ ì˜ˆìˆ˜ ì•ˆì—ì„œ ë„ˆí¬ë¥¼ í–¥í•˜ì‹  í•˜ë‚˜ë‹˜ì˜ ëœ»ì´ë‹ˆë¼' };
        data['008'] = { reference: 'ë§ˆíƒœë³µìŒ 1:21', text: 'ì•„ë“¤ì„ ë‚³ìœ¼ë¦¬ë‹ˆ ì´ë¦„ì„ ì˜ˆìˆ˜ë¼ í•˜ë¼ ì´ëŠ” ê·¸ê°€ ìê¸° ë°±ì„±ì„ ê·¸ë“¤ì˜ ì£„ì—ì„œ êµ¬ì›í•  ìì´ì‹¬ì´ë¼ í•˜ë‹ˆë¼' };
        data['009'] = { reference: 'ìš”í•œë³µìŒ 1:12', text: 'ì˜ì ‘í•˜ëŠ” ì ê³§ ê·¸ ì´ë¦„ì„ ë¯¿ëŠ” ìë“¤ì—ê²ŒëŠ” í•˜ë‚˜ë‹˜ì˜ ìë…€ê°€ ë˜ëŠ” ê¶Œì„¸ë¥¼ ì£¼ì…¨ìœ¼ë‹ˆ' };
        data['010'] = { reference: 'ì‹œí¸ 100:4', text: 'ê°ì‚¬í•¨ìœ¼ë¡œ ê·¸ì˜ ë¬¸ì— ë“¤ì–´ê°€ë©° ì°¬ì†¡í•¨ìœ¼ë¡œ ê·¸ì˜ ê¶ì •ì— ë“¤ì–´ê°€ì„œ ê·¸ì—ê²Œ ê°ì‚¬í•˜ë©° ê·¸ì˜ ì´ë¦„ì„ ì†¡ì¶•í• ì§€ì–´ë‹¤' };
        data['011'] = { reference: 'ì ì–¸ 15:20', text: 'ì§€í˜œë¡œìš´ ì•„ë“¤ì€ ì•„ë¹„ë¥¼ ì¦ê²ê²Œ í•˜ì—¬ë„ ë¯¸ë ¨í•œ ìëŠ” ì–´ë¯¸ë¥¼ ì—…ì‹ ì—¬ê¸°ëŠë‹ˆë¼' };
        data['012'] = { reference: 'ì ì–¸ 1:8', text: 'ë‚´ ì•„ë“¤ì•„ ë„¤ ì•„ë¹„ì˜ í›ˆê³„ë¥¼ ë“¤ìœ¼ë©° ë„¤ ì–´ë¯¸ì˜ ë²•ì„ ë– ë‚˜ì§€ ë§ë¼' };
        data['013'] = { reference: 'ê³¨ë¡œìƒˆì„œ 3:20', text: 'ìë…€ë“¤ì•„ ëª¨ë“  ì¼ì— ë¶€ëª¨ì—ê²Œ ìˆœì¢…í•˜ë¼ ì´ëŠ” ì£¼ ì•ˆì—ì„œ ê¸°ì˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹ˆë¼' };
        data['014'] = { reference: 'ì—ë² ì†Œì„œ 6:1~2', text: 'ìë…€ë“¤ì•„ ì£¼ ì•ˆì—ì„œ ë„ˆí¬ ë¶€ëª¨ì—ê²Œ ìˆœì¢…í•˜ë¼ ì´ê²ƒì´ ì˜³ìœ¼ë‹ˆë¼ ë„¤ ì•„ë²„ì§€ì™€ ì–´ë¨¸ë‹ˆë¥¼ ê³µê²½í•˜ë¼ ì´ê²ƒì€ ì•½ì†ì´ ìˆëŠ” ì²« ê³„ëª…ì´ë‹ˆ' };
        data['015'] = { reference: 'ê³ ë¦°ë„ì „ì„œ 13:4~5', text: 'ì‚¬ë‘ì€ ì˜¤ë˜ ì°¸ê³  ì‚¬ë‘ì€ ì˜¨ìœ í•˜ë©° ì‹œê¸°í•˜ì§€ ì•„ë‹ˆí•˜ë©° ì‚¬ë‘ì€ ìë‘í•˜ì§€ ì•„ë‹ˆí•˜ë©° êµë§Œí•˜ì§€ ì•„ë‹ˆí•˜ë©° ë¬´ë¡€íˆ í–‰í•˜ì§€ ì•„ë‹ˆí•˜ë©° ìê¸°ì˜ ìœ ìµì„ êµ¬í•˜ì§€ ì•„ë‹ˆí•˜ë©° ì„±ë‚´ì§€ ì•„ë‹ˆí•˜ë©° ì•…í•œ ê²ƒì„ ìƒê°í•˜ì§€ ì•„ë‹ˆí•˜ë©°' };
        data['016'] = { reference: 'ì‹œí¸ 119:105', text: 'ì£¼ì˜ ë§ì”€ì€ ë‚´ ë°œì— ë“±ì´ìš” ë‚´ ê¸¸ì— ë¹›ì´ë‹ˆì´ë‹¤' };
        data['017'] = { reference: 'ì´ì‚¬ì•¼ 53:6', text: 'ìš°ë¦¬ëŠ” ë‹¤ ì–‘ ê°™ì•„ì„œ ê·¸ë¦‡ í–‰í•˜ì—¬ ê°ê¸° ì œ ê¸¸ë¡œ ê°”ê±°ëŠ˜ ì—¬í˜¸ì™€ê»˜ì„œëŠ” ìš°ë¦¬ ëª¨ë‘ì˜ ì£„ì•…ì„ ê·¸ì—ê²Œ ë‹´ë‹¹ì‹œí‚¤ì…¨ë„ë‹¤' };
        data['018'] = { reference: 'ë¡œë§ˆì„œ 1:16', text: 'ë‚´ê°€ ë³µìŒì„ ë¶€ë„ëŸ¬ì›Œí•˜ì§€ ì•„ë‹ˆí•˜ë…¸ë‹ˆ ì´ ë³µìŒì€ ëª¨ë“  ë¯¿ëŠ” ìì—ê²Œ êµ¬ì›ì„ ì£¼ì‹œëŠ” í•˜ë‚˜ë‹˜ì˜ ëŠ¥ë ¥ì´ ë¨ì´ë¼ ë¨¼ì €ëŠ” ìœ ëŒ€ì¸ì—ê²Œìš” ê·¸ë¦¬ê³  í—¬ë¼ì¸ì—ê²Œë¡œë‹¤' };
        data['019'] = { reference: 'ë§ˆíƒœë³µìŒ 20:28', text: 'ì¸ìê°€ ì˜¨ ê²ƒì€ ì„¬ê¹€ì„ ë°›ìœ¼ë ¤ í•¨ì´ ì•„ë‹ˆë¼ ë„ë¦¬ì–´ ì„¬ê¸°ë ¤ í•˜ê³  ìê¸° ëª©ìˆ¨ì„ ë§ì€ ì‚¬ëŒì˜ ëŒ€ì†ë¬¼ë¡œ ì£¼ë ¤ í•¨ì´ë‹ˆë¼' };
        data['020'] = { reference: 'ê³¨ë¡œìƒˆì„œ 3:23', text: 'ë¬´ìŠ¨ ì¼ì„ í•˜ë“ ì§€ ë§ˆìŒì„ ë‹¤í•˜ì—¬ ì£¼ê»˜ í•˜ë“¯ í•˜ê³  ì‚¬ëŒì—ê²Œ í•˜ë“¯ í•˜ì§€ ë§ë¼' };
        data['021'] = { reference: 'ë§ˆíƒœë³µìŒ 16:16,18', text: 'ì‹œëª¬ ë² ë“œë¡œê°€ ëŒ€ë‹µí•˜ì—¬ ì´ë¥´ë˜ ì£¼ëŠ” ê·¸ë¦¬ìŠ¤ë„ì‹œìš” ì‚´ì•„ ê³„ì‹  í•˜ë‚˜ë‹˜ì˜ ì•„ë“¤ì´ì‹œë‹ˆì´ë‹¤ / ë˜ ë‚´ê°€ ë„¤ê²Œ ì´ë¥´ë…¸ë‹ˆ ë„ˆëŠ” ë² ë“œë¡œë¼ ë‚´ê°€ ì´ ë°˜ì„ ìœ„ì— ë‚´ êµíšŒë¥¼ ì„¸ìš°ë¦¬ë‹ˆ ìŒë¶€ì˜ ê¶Œì„¸ê°€ ì´ê¸°ì§€ ëª»í•˜ë¦¬ë¼' };
        data['022'] = { reference: 'ë§ˆíƒœë³µìŒ 5:16', text: 'ì´ê°™ì´ ë„ˆí¬ ë¹›ì´ ì‚¬ëŒ ì•ì— ë¹„ì¹˜ê²Œ í•˜ì—¬ ê·¸ë“¤ë¡œ ë„ˆí¬ ì°©í•œ í–‰ì‹¤ì„ ë³´ê³  í•˜ëŠ˜ì— ê³„ì‹  ë„ˆí¬ ì•„ë²„ì§€ê»˜ ì˜ê´‘ì„ ëŒë¦¬ê²Œ í•˜ë¼' };
        data['023'] = { reference: 'ì‹œí¸ 136:1', text: 'ì—¬í˜¸ì™€ê»˜ ê°ì‚¬í•˜ë¼ ê·¸ëŠ” ì„ í•˜ì‹œë©° ê·¸ ì¸ìí•˜ì‹¬ì´ ì˜ì›í•¨ì´ë¡œë‹¤' };
        return data;
      };

      const [verses, setVerses] = useState({});
      const [isLoading, setIsLoading] = useState(true);
      const [selectedCard, setSelectedCard] = useState('001');
      const [showUploadModal, setShowUploadModal] = useState(false);
      const [pasteText, setPasteText] = useState('');
      const [notification, setNotification] = useState('');
      const [counts, setCounts] = useState({});
      const [showAllCounts, setShowAllCounts] = useState(false);
      const [showAllVerses, setShowAllVerses] = useState(false);
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
      const [showDeleteMenu, setShowDeleteMenu] = useState(false);
      const [showSearchModal, setShowSearchModal] = useState(false);
      const [searchQuery, setSearchQuery] = useState('');
      const [showStatsModal, setShowStatsModal] = useState(false);
      const [showQuizMode, setShowQuizMode] = useState(false);
      const [quizCard, setQuizCard] = useState(null);
      const [showQuizAnswer, setShowQuizAnswer] = useState(false);
      const [showResetCountModal, setShowResetCountModal] = useState(false);
      const [dailyHistory, setDailyHistory] = useState({});
      const [encouragementMsg, setEncouragementMsg] = useState('');
      const [showMultiDeleteModal, setShowMultiDeleteModal] = useState(false);
      const [selectedForDelete, setSelectedForDelete] = useState([]);
      const [showAddModal, setShowAddModal] = useState(false);
      const [showEditModal, setShowEditModal] = useState(false);
      const [newCardNumber, setNewCardNumber] = useState('');
      const [newCardReference, setNewCardReference] = useState('');
      const [newCardText, setNewCardText] = useState('');
      const [editCardReference, setEditCardReference] = useState('');
      const [editCardText, setEditCardText] = useState('');

      // localStorage í—¬í¼ í•¨ìˆ˜
      const storage = {
        get: (key) => {
          try {
            const value = localStorage.getItem(key);
            return value ? { value } : null;
          } catch (e) {
            console.error('localStorage get error:', e);
            return null;
          }
        },
        set: (key, value) => {
          try {
            localStorage.setItem(key, value);
            return true;
          } catch (e) {
            console.error('localStorage set error:', e);
            return false;
          }
        }
      };

      useEffect(() => {
        const loadData = () => {
          try {
            const versesResult = storage.get('memoryVerses');
            if (versesResult?.value) {
              setVerses(JSON.parse(versesResult.value));
              notify('âœ… ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤');
            } else {
              const initialData = generateEmptyData();
              setVerses(initialData);
              storage.set('memoryVerses', JSON.stringify(initialData));
              notify('ğŸ“– ì„±ê²½ ì•”ì†¡ ì¹´ë“œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!');
            }

            const countsResult = storage.get('memoryCounts');
            if (countsResult?.value) {
              setCounts(JSON.parse(countsResult.value));
            } else {
              setCounts({});
            }

            const historyResult = storage.get('dailyHistory');
            if (historyResult?.value) {
              setDailyHistory(JSON.parse(historyResult.value));
            } else {
              setDailyHistory({});
            }
          } catch (error) {
            console.error('ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
            const initialData = generateEmptyData();
            setVerses(initialData);
            setCounts({});
            setDailyHistory({});
            notify('âš ï¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨. ê¸°ë³¸ ë§ì”€ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.', 3000);
          }
          
          setIsLoading(false);
        };
        
        loadData();
      }, []);

      useEffect(() => {
        if (!isLoading && Object.keys(verses).length > 0) {
          storage.set('memoryVerses', JSON.stringify(verses));
        }
      }, [verses, isLoading]);

      useEffect(() => {
        if (!isLoading) {
          storage.set('memoryCounts', JSON.stringify(counts));
        }
      }, [counts, isLoading]);

      useEffect(() => {
        if (!isLoading) {
          storage.set('dailyHistory', JSON.stringify(dailyHistory));
        }
      }, [dailyHistory, isLoading]);

      const notify = (message, duration = 3000) => {
        setNotification(message);
        setTimeout(() => setNotification(''), duration);
      };

      const parseContent = (text) => {
        const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
        const updates = {};
        let successCount = 0;
        const duplicates = [];

        lines.forEach(line => {
          if (line.includes('ë²ˆí˜¸') || line.includes('ì„±ê²½') || line.includes('ë³¸ë¬¸') || line.includes('êµ¬ì ˆ')) {
            return;
          }

          const normalized = line.replace(/[\s\t]+/g, ' ').trim();
          
          let pattern = /^([A-E]0?\d{1,2}|\d{3})\s+([ê°€-í£\s]+?)\s+(\d+)\s*:\s*(\d+)\s+(.+?)\.?$/;
          let match = normalized.match(pattern);
          
          if (!match) {
            pattern = /^([A-E]0?\d{1,2}|\d{3})\s+([ê°€-í£\s]+?)\s+(\d+)\s*:\s*(\d+\s*[-~]\s*\d+)\s+(.+?)\.?$/;
            match = normalized.match(pattern);
          }
          
          if (!match) {
            pattern = /^([A-E]0?\d{1,2}|\d{3})\s+([ê°€-í£\s]+?)\s+(\d+)\s*:\s*(\d+\s*,\s*\d+)\s+(.+?)\.?$/;
            match = normalized.match(pattern);
          }
          
          if (!match) {
            pattern = /^([A-E]0?\d{1,2}|\d{3})\s+([ê°€-í£\s]+?)\s+(\d+)\s*:\s*(\d+)$/;
            match = normalized.match(pattern);
            if (match) {
              match.push('(ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”)');
            }
          }
          
          if (!match) {
            pattern = /^([A-E]0?\d{1,2}|\d{3})\s+([ê°€-í£\s]+?)\s+(\d+)\s*:\s*(\d+\s*[-~]\s*\d+)$/;
            match = normalized.match(pattern);
            if (match) {
              match.push('(ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”)');
            }
          }
          
          if (!match) {
            pattern = /^([A-E]0?\d{1,2}|\d{3})\s+([ê°€-í£\s]+?)\s+(\d+)\s*:\s*(\d+\s*,\s*\d+)$/;
            match = normalized.match(pattern);
            if (match) {
              match.push('(ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”)');
            }
          }
          
          if (match) {
            let cardKey = match[1].toUpperCase();
            const bookName = match[2].trim();
            const chapter = match[3];
            const verse = match[4].replace(/\s/g, '');
            const reference = `${bookName} ${chapter}:${verse}`;
            const verseText = match[5] ? match[5].trim() : '(ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”)';
            
            const existingInVerses = Object.entries(verses).find(([key, value]) => 
              value.reference === reference && key !== cardKey
            );
            const existingInUpdates = Object.entries(updates).find(([key, value]) => 
              value.reference === reference && key !== cardKey
            );
            
            if (existingInVerses) {
              duplicates.push(`${reference} (ê¸°ì¡´: ${existingInVerses[0]})`);
            } else if (existingInUpdates) {
              duplicates.push(`${reference} (ë°°ì¹˜ ë‚´ ì¤‘ë³µ: ${existingInUpdates[0]})`);
            } else {
              updates[cardKey] = { reference, text: verseText };
              successCount++;
            }
          }
        });
        
        return { updates, successCount, duplicates };
      };

      const handlePasteSubmit = () => {
        if (!pasteText.trim()) {
          notify('âš ï¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
          return;
        }
        const { updates, successCount, duplicates } = parseContent(pasteText);
        
        if (duplicates.length > 0) {
          setVerses(prev => ({ ...prev, ...updates }));
          notify(`âš ï¸ ${successCount}ê°œ ì¶”ê°€, ${duplicates.length}ê°œ ì¤‘ë³µ ì œì™¸`, 3000);
          setTimeout(() => { setPasteText(''); setShowUploadModal(false); }, 3000);
        } else if (successCount > 0) {
          setVerses(prev => ({ ...prev, ...updates }));
          notify(`âœ… ${successCount}ê°œì˜ ë§ì”€ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤`, 2000);
          setTimeout(() => { setPasteText(''); setShowUploadModal(false); }, 2000);
        } else {
          notify('âŒ ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ë§ì”€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 3000);
        }
      };

      const handleFileUpload = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.name.endsWith('.docx')) {
          notify('âŒ .docx íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
          e.target.value = '';
          return;
        }

        notify('ğŸ“„ íŒŒì¼ ì½ëŠ” ì¤‘...', 10000);

        try {
          if (!window.mammoth) {
            notify('ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘...', 10000);
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js';
            document.head.appendChild(script);
            await new Promise((resolve, reject) => {
              script.onload = resolve;
              script.onerror = () => reject(new Error('ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹¤íŒ¨'));
              setTimeout(() => reject(new Error('íƒ€ì„ì•„ì›ƒ')), 15000);
            });
          }

          notify('ğŸ“– íŒŒì¼ ë‚´ìš© ì¶”ì¶œ ì¤‘...', 10000);
          const arrayBuffer = await file.arrayBuffer();
          
          notify('âœï¸ í…ìŠ¤íŠ¸ ë³€í™˜ ì¤‘...', 10000);
          const result = await window.mammoth.extractRawText({ arrayBuffer });
          const text = result.value;

          if (!text || text.trim().length === 0) {
            notify('âŒ íŒŒì¼ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            e.target.value = '';
            return;
          }

          notify('ğŸ” ë§ì”€ ë¶„ì„ ì¤‘...', 10000);
          const { updates, successCount, duplicates } = parseContent(text);
          
          if (duplicates.length > 0) {
            setVerses(prev => ({ ...prev, ...updates }));
            notify(`âš ï¸ ${successCount}ê°œ ì¶”ê°€, ${duplicates.length}ê°œ ì¤‘ë³µ ì œì™¸`, 3000);
            setTimeout(() => setShowUploadModal(false), 3000);
          } else if (successCount > 0) {
            setVerses(prev => ({ ...prev, ...updates }));
            notify(`âœ… ${successCount}ê°œì˜ ë§ì”€ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤`, 2000);
            setTimeout(() => setShowUploadModal(false), 2000);
          } else {
            notify('âŒ ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ë§ì”€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 3000);
          }
        } catch (error) {
          console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
          notify('âŒ íŒŒì¼ ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message, 5000);
        } finally {
          e.target.value = '';
        }
      };

      const handleBackup = () => {
        const backupData = {
          verses, counts, dailyHistory,
          backupDate: new Date().toISOString()
        };
        const dataStr = JSON.stringify(backupData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ì„±ê²½ì•”ì†¡ì¹´ë“œ_ë°±ì—…_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        notify('âœ… ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤');
      };

      const handleRestore = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const backupData = JSON.parse(event.target.result);
            if (backupData.verses && backupData.counts) {
              setVerses(backupData.verses);
              setCounts(backupData.counts);
              if (backupData.dailyHistory) setDailyHistory(backupData.dailyHistory);
              notify('âœ… ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤');
            } else {
              notify('âŒ ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤');
            }
          } catch (error) {
            notify('âŒ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + error.message);
          }
        };
        reader.readAsText(file);
        e.target.value = '';
      };

      const searchVerses = () => {
        if (!searchQuery.trim()) return [];
        const query = searchQuery.toLowerCase();
        return Object.keys(verses).filter(key => {
          const verse = verses[key];
          return (
            verse.reference?.toLowerCase().includes(query) ||
            verse.text?.toLowerCase().includes(query) ||
            key.toLowerCase().includes(query)
          );
        });
      };

      const selectRandomCard = () => {
        const validCards = Object.keys(verses).filter(key => 
          verses[key].reference && verses[key].text
        );
        if (validCards.length === 0) {
          notify('âš ï¸ ë“±ë¡ëœ ë§ì”€ì´ ì—†ìŠµë‹ˆë‹¤');
          return;
        }
        const randomKey = validCards[Math.floor(Math.random() * validCards.length)];
        setQuizCard(randomKey);
        setShowQuizAnswer(false);
        setShowQuizMode(true);
      };

      const playCelebrationMelody = async (level) => {
        try {
          if (!window.Tone) {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js';
            document.head.appendChild(script);
            await new Promise(resolve => { script.onload = resolve; });
          }

          await window.Tone.start();
          const synth = new window.Tone.Synth({
            oscillator: { type: 'sine' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 0.8 }
          }).toDestination();

          const now = window.Tone.now();
          
          const melodies = {
            1: [['G4', 0], ['G4', 0.2], ['A4', 0.4], ['A4', 0.6], ['G4', 0.8], ['G4', 1.0], ['E4', 1.2]],
            2: [['C4', 0], ['C4', 0.3], ['G4', 0.6], ['G4', 0.9], ['A4', 1.2], ['A4', 1.5], ['G4', 1.8]],
            3: [['C4', 0], ['C4', 0.25], ['D4', 0.5], ['C4', 0.75], ['F4', 1.0], ['E4', 1.5]],
            4: [['C4', 0], ['E4', 0.15], ['G4', 0.3], ['C5', 0.45], ['G4', 0.6], ['C5', 0.75], ['E5', 0.9], ['C5', 1.05], ['G4', 1.2], ['C5', 1.4]]
          };

          const melody = level <= 3 ? melodies[level] : melodies[4];
          melody.forEach(([note, time]) => {
            synth.triggerAttackRelease(note, '8n', now + time);
          });
        } catch (error) {
          console.log('ë©œë¡œë”” ì¬ìƒ ì‹¤íŒ¨:', error);
        }
      };

      const incrementCount = (cardKey) => {
        const today = new Date().toISOString().split('T')[0];
        const newCount = (counts[cardKey] || 0) + 1;
        
        setCounts(prev => ({...prev, [cardKey]: newCount}));
        setDailyHistory(prev => ({
          ...prev,
          [today]: {
            ...prev[today],
            [cardKey]: ((prev[today]?.[cardKey]) || 0) + 1
          }
        }));

        if (newCount > 0 && newCount % 10 === 0) {
          const messages = [
            'ğŸ‰ 10íšŒ ë‹¬ì„±! ì¢‹ì€ ì‹œì‘ì´ì—ìš”!',
            'ğŸŒŸ 20íšŒ ë‹¬ì„±! ì ì  ìµìˆ™í•´ì§€ê³  ìˆì–´ìš”!',
            'ğŸ’ª 30íšŒ ë‹¬ì„±! ê³„ì† ì´ ê¸°ì„¸ë¡œ!',
            'ğŸ”¥ 40íšŒ ë‹¬ì„±! ì •ë§ ëŒ€ë‹¨í•´ìš”!',
            'â­ 50íšŒ ë‹¬ì„±! ì ˆë°˜ì„ ë„˜ì—ˆì–´ìš”!',
            'ğŸŠ 60íšŒ ë‹¬ì„±! ê±°ì˜ ë‹¤ ì™”ì–´ìš”!',
            'ğŸ‘ 70íšŒ ë‹¬ì„±! ë†€ë¼ìš´ ì„±ê³¼ì˜ˆìš”!',
            'ğŸ† 80íšŒ ë‹¬ì„±! ìµœê³ ì˜ ì•”ì†¡ì™•!',
            'ğŸ’ 90íšŒ ë‹¬ì„±! ì™„ë²½ì— ê°€ê¹Œì›Œìš”!',
            'ğŸ‘‘ 100íšŒ ë‹¬ì„±! ì¶•í•˜í•©ë‹ˆë‹¤! ì™„ì „ ë§ˆìŠ¤í„°!'
          ];
          
          const messageIndex = Math.floor(newCount / 10) - 1;
          const message = messageIndex < messages.length 
            ? messages[messageIndex] 
            : `ğŸŒˆ ${newCount}íšŒ ë‹¬ì„±! ì •ë§ ëŒ€ë‹¨í•©ë‹ˆë‹¤!`;
          
          setEncouragementMsg(message);
          setTimeout(() => setEncouragementMsg(''), 7000);
          
          const melodyLevel = Math.min(Math.floor(newCount / 10), 4);
          playCelebrationMelody(melodyLevel);
        }
      };

      const getStats = () => {
        const totalCount = Object.values(counts).reduce((sum, count) => sum + count, 0);
        const activeCards = Object.values(counts).filter(c => c > 0).length;
        const verseCards = Object.keys(verses).filter(k => verses[k].reference && verses[k].text).length;
        
        const sortedCounts = Object.entries(counts)
          .filter(([key]) => verses[key]?.reference && verses[key]?.text)
          .sort((a, b) => b[1] - a[1]);
        
        const mostMemorized = sortedCounts.slice(0, 5);
        const leastMemorized = sortedCounts.filter(([_, count]) => count === 0 || count < 3).slice(0, 5);
        
        const last7Days = [];
        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split('T')[0];
          const dayTotal = dailyHistory[dateStr] 
            ? Object.values(dailyHistory[dateStr]).reduce((sum, count) => sum + count, 0)
            : 0;
          last7Days.push({ date: dateStr, count: dayTotal });
        }

        return { totalCount, activeCards, verseCards, mostMemorized, leastMemorized, last7Days };
      };

      const resetCounters = (type) => {
        if (type === 'all') {
          setCounts({});
          setDailyHistory({});
          notify('âœ… ì „ì²´ ì•”ì†¡ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        } else if (type === '0') {
          const newCounts = {...counts};
          Object.keys(newCounts).forEach(key => {
            if (key.startsWith('0')) delete newCounts[key];
          });
          setCounts(newCounts);
          notify(`âœ… 0XX ê·¸ë£¹ ì•”ì†¡ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤`);
        } else if (type.match(/^[A-E]$/)) {
          const newCounts = {...counts};
          Object.keys(newCounts).forEach(key => {
            if (key.startsWith(type)) delete newCounts[key];
          });
          setCounts(newCounts);
          notify(`âœ… ${type} ê·¸ë£¹ ì•”ì†¡ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤`);
        }
        setShowResetCountModal(false);
      };

      const goToPrevious = () => {
        const keys = Object.keys(verses).sort();
        const currentIndex = keys.indexOf(selectedCard);
        if (currentIndex > 0) setSelectedCard(keys[currentIndex - 1]);
      };

      const goToNext = () => {
        const keys = Object.keys(verses).sort();
        const currentIndex = keys.indexOf(selectedCard);
        if (currentIndex < keys.length - 1) setSelectedCard(keys[currentIndex + 1]);
      };

      const handleDeleteCard = () => {
        const newVerses = {...verses};
        delete newVerses[selectedCard];
        setVerses(newVerses);
        
        const newCounts = {...counts};
        delete newCounts[selectedCard];
        setCounts(newCounts);
        
        const newDailyHistory = {...dailyHistory};
        Object.keys(newDailyHistory).forEach(date => {
          if (newDailyHistory[date][selectedCard]) {
            delete newDailyHistory[date][selectedCard];
          }
        });
        setDailyHistory(newDailyHistory);
        
        const remainingKeys = Object.keys(newVerses).sort();
        if (remainingKeys.length > 0) setSelectedCard(remainingKeys[0]);
        
        setShowDeleteConfirm(false);
        setShowDeleteMenu(false);
        notify(`âœ… ${selectedCard} ì¹´ë“œì™€ ì•”ì†¡ ê¸°ë¡ì´ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`);
      };

      const toggleCardSelection = (key) => {
        setSelectedForDelete(prev => 
          prev.includes(key) ? prev.filter(k => k !== key) : [...prev, key]
        );
      };

      const selectAllCards = () => setSelectedForDelete(Object.keys(verses).sort());
      const deselectAllCards = () => setSelectedForDelete([]);

      const handleAddCard = () => {
        if (!newCardNumber.trim()) { notify('âš ï¸ ì¹´ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
        if (!newCardReference.trim()) { notify('âš ï¸ ì„±ê²½ êµ¬ì ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
        if (!newCardText.trim()) { notify('âš ï¸ ë³¸ë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

        const cardKey = newCardNumber.toUpperCase().trim();
        
        if (verses[cardKey]) { notify(`âš ï¸ ${cardKey} ì¹´ë“œê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤`); return; }

        const existingCard = Object.entries(verses).find(([key, value]) => 
          value.reference === newCardReference.trim()
        );
        
        if (existingCard) {
          notify(`âš ï¸ ${newCardReference}ëŠ” ì´ë¯¸ ${existingCard[0]} ì¹´ë“œì— ìˆìŠµë‹ˆë‹¤`);
          return;
        }

        setVerses(prev => ({
          ...prev,
          [cardKey]: { reference: newCardReference.trim(), text: newCardText.trim() }
        }));

        notify(`âœ… ${cardKey} ì¹´ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`);
        setSelectedCard(cardKey);
        setNewCardNumber('');
        setNewCardReference('');
        setNewCardText('');
        setShowAddModal(false);
      };

      const handleEditCard = () => {
        if (!editCardReference.trim()) { notify('âš ï¸ ì„±ê²½ êµ¬ì ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
        if (!editCardText.trim()) { notify('âš ï¸ ë³¸ë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

        setVerses(prev => ({
          ...prev,
          [selectedCard]: { reference: editCardReference.trim(), text: editCardText.trim() }
        }));

        notify(`âœ… ${selectedCard} ì¹´ë“œê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤`);
        setShowEditModal(false);
      };

      const openEditModal = () => {
        setEditCardReference(currentCard.reference || '');
        setEditCardText(currentCard.text || '');
        setShowEditModal(true);
      };

      const handleDeleteSelectedCards = () => {
        if (selectedForDelete.length === 0) { notify('âš ï¸ ì‚­ì œí•  ì¹´ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }

        const newVerses = {...verses};
        const newCounts = {...counts};
        const newDailyHistory = {...dailyHistory};
        
        selectedForDelete.forEach(key => {
          delete newVerses[key];
          delete newCounts[key];
          Object.keys(newDailyHistory).forEach(date => {
            if (newDailyHistory[date][key]) delete newDailyHistory[date][key];
          });
        });
        
        setVerses(newVerses);
        setCounts(newCounts);
        setDailyHistory(newDailyHistory);
        
        const remainingKeys = Object.keys(newVerses).sort();
        if (remainingKeys.length > 0) setSelectedCard(remainingKeys[0]);
        else setSelectedCard('');
        
        notify(`âœ… ${selectedForDelete.length}ê°œì˜ ì¹´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`);
        setSelectedForDelete([]);
        setShowMultiDeleteModal(false);
        setShowDeleteMenu(false);
      };

      const currentCard = verses[selectedCard] || { reference: '', text: '' };
      const keys = Object.keys(verses).sort();
      const currentIndex = keys.indexOf(selectedCard);
      const currentCount = counts[selectedCard] || 0;
      const searchResults = searchVerses();
      const stats = getStats();

      const getCharacter = (count) => {
        if (count === 0) return { emoji: 'ğŸ˜Š' };
        if (count < 10) return { emoji: 'ğŸ»' };
        if (count < 20) return { emoji: 'ğŸ±' };
        if (count < 30) return { emoji: 'ğŸ™' };
        if (count < 40) return { emoji: 'ğŸ¤' };
        if (count < 50) return { emoji: 'ğŸ°' };
        if (count < 60) return { emoji: 'ğŸ§' };
        if (count < 70) return { emoji: 'ğŸµ' };
        if (count < 80) return { emoji: 'ğŸ¶' };
        if (count < 90) return { emoji: 'ğŸ®' };
        return { emoji: 'ğŸ‘‘' };
      };

      const currentCharacter = getCharacter(currentCount);

      return (
        <div className="min-h-screen" style={{ background: 'linear-gradient(180deg, #e8eaf6 0%, #f3e5f5 100%)' }}>
          {isLoading ? (
            <div className="min-h-screen flex items-center justify-center">
              <div className="text-center">
                <div className="text-4xl mb-4">ğŸ“–</div>
                <div className="text-lg font-bold text-purple-700">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
              </div>
            </div>
          ) : (
            <>
              {notification && (
                <div className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-white text-gray-800 px-6 py-3 rounded-xl font-bold text-sm shadow-2xl z-50">
                  {notification}
                </div>
              )}

              <div className="max-w-md mx-auto">
                {/* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */}
                <div className="bg-white shadow-lg p-4 mb-3">
                  <h1 className="text-2xl font-black text-center mb-4 text-purple-700">ğŸ“– ì„±ê²½ ì•”ì†¡ ì¹´ë“œ ğŸ“–</h1>
                  
                  <div className="mb-3">
                    <label className="flex items-center gap-2 text-sm font-bold text-gray-700 mb-2">
                      ğŸ“‡ ì•”ì†¡ ì¹´ë“œ ì„ íƒ
                    </label>
                    {keys.length > 0 ? (
                      <div className="flex gap-2 items-center">
                        <button
                          onClick={goToPrevious}
                          disabled={currentIndex === 0 || keys.length === 0}
                          className="px-1.5 py-1.5 bg-purple-500 text-white rounded-xl font-bold hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors text-xs"
                        >
                          â—€
                        </button>
                        <select 
                          value={selectedCard}
                          onChange={(e) => setSelectedCard(e.target.value)}
                          className="flex-1 px-2 py-1.5 border-2 border-purple-300 rounded-xl font-bold bg-white focus:border-purple-500 focus:outline-none"
                          style={{ fontSize: '15px' }}
                        >
                          {keys.map(key => {
                            const v = verses[key];
                            const hasContent = v && v.reference && v.text;
                            const displayText = hasContent ? `${key} - ${v.reference} âœ…` : `${key} âšª`;
                            return <option key={key} value={key} style={{ fontSize: '10px' }}>{displayText}</option>;
                          })}
                        </select>
                        <button
                          onClick={goToNext}
                          disabled={currentIndex === keys.length - 1 || keys.length === 0}
                          className="px-1.5 py-1.5 bg-purple-500 text-white rounded-xl font-bold hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors text-xs"
                        >
                          â–¶
                        </button>
                      </div>
                    ) : (
                      <div className="text-center py-8 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                        <p className="text-gray-400 font-bold mb-3">ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <button
                          onClick={() => setShowUploadModal(true)}
                          className="px-6 py-2 bg-purple-500 text-white rounded-lg font-bold hover:bg-purple-600"
                        >
                          ë§ì”€ ì¶”ê°€í•˜ê¸°
                        </button>
                      </div>
                    )}
                  </div>
                </div>

                {/* í˜„ì¬ ì•”ì†¡ ì¹´ë“œ */}
                {keys.length > 0 && (
                  <>
                    <div style={{ background: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', padding: '5px', borderRadius: '24px' }}>
                      <div className="bg-white rounded-3xl p-5 shadow-lg">
                        <div className="flex items-center justify-center mb-3">
                          <span style={{ fontSize: '20px', marginRight: '0.375rem' }}>ğŸ¶</span>
                          <div className="text-center flex-1">
                            <div className="flex items-center justify-center gap-2">
                              <span className="font-black text-green-600" style={{ fontSize: '18px' }}>{selectedCard}</span>
                              <span className="font-bold text-gray-400" style={{ fontSize: '18px' }}>-</span>
                              {currentCard.reference && (
                                <span className="font-black text-gray-900" style={{ fontSize: '20px', lineHeight: '1.3' }}>
                                  {currentCard.reference}
                                </span>
                              )}
                            </div>
                          </div>
                          <span style={{ fontSize: '20px', marginLeft: '0.375rem' }}>ğŸ±</span>
                        </div>
                        {currentCard.reference && currentCard.text ? (
                          <div className="font-bold text-gray-800" style={{ fontSize: '20px', lineHeight: '1.5', wordBreak: 'keep-all' }}>
                            {currentCard.text}
                          </div>
                        ) : (
                          <div className="text-center py-8">
                            <p className="text-gray-400 font-bold text-base">ë§ì”€ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</p>
                            <button 
                              onClick={() => setShowUploadModal(true)}
                              className="mt-3 px-6 py-2 bg-purple-500 text-white rounded-lg font-bold text-sm"
                            >
                              ë§ì”€ ì¶”ê°€í•˜ê¸°
                            </button>
                          </div>
                        )}
                      </div>
                    </div>

                    {/* ì¹´ìš´í„° */}
                    <div className="mt-4 bg-white rounded-3xl p-6 shadow-lg">
                      <div className="flex items-start justify-between mb-2">
                        <button
                          onClick={() => setCounts(prev => ({...prev, [selectedCard]: 0}))}
                          className="px-3 py-1.5 bg-gray-300 text-gray-700 rounded-lg font-bold text-xs hover:bg-gray-400 transition-colors"
                        >
                          í˜„ì¬ ì´ˆê¸°í™”
                        </button>
                        <button
                          onClick={() => setShowResetCountModal(true)}
                          className="p-1.5 bg-gray-400 text-white rounded-lg font-bold hover:bg-gray-500 transition-colors"
                        >
                          <RotateCcw className="w-4 h-4" />
                        </button>
                      </div>
                      
                      <div className="flex items-center justify-center gap-4 mb-4">
                        <div className="text-7xl">{currentCharacter.emoji}</div>
                        <div className="text-8xl font-black text-purple-600">{currentCount}</div>
                      </div>
                      <p className="text-sm font-bold text-gray-500 text-center mb-4">ì•”ì†¡ íšŸìˆ˜</p>
                      
                      {encouragementMsg && (
                        <div className="mb-4 bg-gradient-to-r from-yellow-100 to-pink-100 rounded-xl p-3 text-center animate-pulse">
                          <p className="text-base font-black text-purple-700">{encouragementMsg}</p>
                        </div>
                      )}
                      
                      <div className="flex gap-5 justify-center">
                        <button
                          onClick={() => setCounts(prev => ({...prev, [selectedCard]: Math.max(0, (prev[selectedCard] || 0) - 1)}))}
                          className="w-20 py-2 bg-red-500 text-white rounded-xl font-black text-2xl hover:bg-red-600 transition-colors"
                        >
                          -1
                        </button>
                        <button
                          onClick={() => incrementCount(selectedCard)}
                          className="w-20 py-2 bg-green-500 text-white rounded-xl font-black text-2xl hover:bg-green-600 transition-colors"
                        >
                          +1
                        </button>
                      </div>
                    </div>

                    {/* í•˜ë‹¨ ë²„íŠ¼ ê·¸ë¦¬ë“œ */}
                    <div className="mt-4 bg-white rounded-3xl p-4 shadow-lg">
                      <div className="grid grid-cols-4 gap-2 mb-2">
                        <button onClick={() => setShowAddModal(true)} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <span className="text-base mb-0.5">â•</span>ê°œë³„ì¶”ê°€
                        </button>
                        <button onClick={() => setShowUploadModal(true)} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-indigo-500 to-indigo-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <Upload className="w-4 h-4 mb-0.5" />ëŒ€ëŸ‰ì¶”ê°€
                        </button>
                        <button onClick={openEditModal} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-amber-500 to-amber-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <span className="text-base mb-0.5">âœï¸</span>ìˆ˜ì •
                        </button>
                        <button onClick={() => setShowSearchModal(true)} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-teal-500 to-teal-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <Search className="w-4 h-4 mb-0.5" />ê²€ìƒ‰
                        </button>
                      </div>

                      <div className="grid grid-cols-4 gap-2 mb-2">
                        <button onClick={() => setShowAllVerses(true)} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <span className="text-base mb-0.5">ğŸ“–</span>ë§ì”€ëª©ë¡
                        </button>
                        <button onClick={selectRandomCard} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-pink-500 to-pink-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <Shuffle className="w-4 h-4 mb-0.5" />í€´ì¦ˆ
                        </button>
                        <button onClick={() => setShowAllCounts(true)} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <span className="text-base mb-0.5">ğŸ“Š</span>ê¸°ë¡
                        </button>
                        <button onClick={() => setShowStatsModal(true)} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <BarChart3 className="w-4 h-4 mb-0.5" />í†µê³„
                        </button>
                      </div>

                      <div className="grid grid-cols-3 gap-1.5">
                        <button onClick={handleBackup} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-cyan-500 to-cyan-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <Download className="w-4 h-4 mb-0.5" />ë°±ì—…
                        </button>
                        <label className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow cursor-pointer">
                          <Upload className="w-4 h-4 mb-0.5" />ë³µì›
                          <input type="file" accept=".json" onChange={handleRestore} className="hidden" />
                        </label>
                        <button onClick={() => setShowDeleteMenu(true)} className="flex flex-col items-center justify-center p-2 bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl font-bold text-xs shadow-lg hover:shadow-xl transition-shadow">
                          <X className="w-4 h-4 mb-0.5" />ì‚­ì œ
                        </button>
                      </div>
                    </div>
                  </>
                )}
              </div>

              {/* ê°œë³„ ì¶”ê°€ ëª¨ë‹¬ */}
              {showAddModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-lg shadow-2xl">
                    <h2 className="text-2xl font-black mb-4 text-gray-800">â• ê°œë³„ ì¹´ë“œ ì¶”ê°€</h2>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-gray-700 mb-2">ì¹´ë“œ ë²ˆí˜¸</label>
                        <input type="text" value={newCardNumber} onChange={(e) => setNewCardNumber(e.target.value)} placeholder="ì˜ˆ: A01, E07, 001" className="w-full p-3 border-2 border-blue-300 rounded-xl focus:border-blue-500 focus:outline-none font-bold" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-gray-700 mb-2">ì„±ê²½ êµ¬ì ˆ</label>
                        <input type="text" value={newCardReference} onChange={(e) => setNewCardReference(e.target.value)} placeholder="ì˜ˆ: ìš”í•œë³µìŒ 3:16" className="w-full p-3 border-2 border-blue-300 rounded-xl focus:border-blue-500 focus:outline-none font-bold" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-gray-700 mb-2">ë³¸ë¬¸</label>
                        <textarea value={newCardText} onChange={(e) => setNewCardText(e.target.value)} placeholder="ì„±ê²½ ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." className="w-full h-40 p-3 border-2 border-blue-300 rounded-xl focus:border-blue-500 focus:outline-none resize-none font-bold" />
                      </div>
                    </div>

                    <div className="flex gap-3 mt-6">
                      <button onClick={() => { setShowAddModal(false); setNewCardNumber(''); setNewCardReference(''); setNewCardText(''); }} className="flex-1 p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ì·¨ì†Œ</button>
                      <button onClick={handleAddCard} className="flex-1 p-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700">ì¶”ê°€í•˜ê¸°</button>
                    </div>
                  </div>
                </div>
              )}

              {/* ìˆ˜ì • ëª¨ë‹¬ */}
              {showEditModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-lg shadow-2xl">
                    <h2 className="text-2xl font-black mb-4 text-gray-800">âœï¸ ì¹´ë“œ ìˆ˜ì •</h2>
                    
                    <div className="mb-4 p-3 bg-purple-50 rounded-xl">
                      <p className="text-sm font-bold text-purple-700">ì¹´ë“œ ë²ˆí˜¸: <span className="text-purple-900">{selectedCard}</span></p>
                    </div>

                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-gray-700 mb-2">ì„±ê²½ êµ¬ì ˆ</label>
                        <input type="text" value={editCardReference} onChange={(e) => setEditCardReference(e.target.value)} placeholder="ì˜ˆ: ìš”í•œë³µìŒ 3:16" className="w-full p-3 border-2 border-amber-300 rounded-xl focus:border-amber-500 focus:outline-none font-bold" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-gray-700 mb-2">ë³¸ë¬¸</label>
                        <textarea value={editCardText} onChange={(e) => setEditCardText(e.target.value)} placeholder="ì„±ê²½ ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." className="w-full h-40 p-3 border-2 border-amber-300 rounded-xl focus:border-amber-500 focus:outline-none resize-none font-bold" />
                      </div>
                    </div>

                    <div className="flex gap-3 mt-6">
                      <button onClick={() => setShowEditModal(false)} className="flex-1 p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ì·¨ì†Œ</button>
                      <button onClick={handleEditCard} className="flex-1 p-3 bg-amber-600 text-white rounded-xl font-bold hover:bg-amber-700">ìˆ˜ì •í•˜ê¸°</button>
                    </div>
                  </div>
                </div>
              )}

              {/* ì—…ë¡œë“œ ëª¨ë‹¬ */}
              {showUploadModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl">
                    <h2 className="text-2xl font-black mb-4 text-gray-800">ğŸ“¦ ëŒ€ëŸ‰ ë§ì”€ ê°€ì ¸ì˜¤ê¸°</h2>
                    
                    <div className="space-y-4">
                      <div className="border-2 border-blue-500 rounded-xl p-4 bg-blue-50">
                        <h3 className="text-lg font-black mb-3 text-blue-700">ğŸ“ í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸°</h3>
                        <textarea value={pasteText} onChange={(e) => setPasteText(e.target.value)} className="w-full h-48 p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none text-sm" placeholder={`ë§ì”€ ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...

ì˜ˆì‹œ (ë‹¤ì–‘í•œ í˜•ì‹ ëª¨ë‘ ê°€ëŠ¥):
A01 ê³ ë¦°ë„í›„ì„œ 5:17 ê·¸ëŸ°ì¦‰ ëˆ„êµ¬ë“ ì§€ ê·¸ë¦¬ìŠ¤ë„ ì•ˆì— ìˆìœ¼ë©´...
E07 ìš”í•œë³µìŒ 15:8 ë„ˆí¬ê°€ ì—´ë§¤ë¥¼ ë§ì´ ë§ºìœ¼ë©´...
C07 ì‹œí¸ 119:9-11 ì²­ë…„ì´ ë¬´ì—‡ìœ¼ë¡œ ê·¸ì˜ í–‰ì‹¤ì„...`} />
                        <button onClick={handlePasteSubmit} className="w-full mt-3 p-3 bg-blue-600 text-white rounded-lg font-bold">ì¶”ê°€í•˜ê¸°</button>
                      </div>

                      <div className="border-2 border-purple-500 rounded-xl p-4 bg-purple-50">
                        <h3 className="text-lg font-black mb-3 text-purple-700">ğŸ“„ ì›Œë“œ íŒŒì¼ ì—…ë¡œë“œ</h3>
                        <label className="block">
                          <div className="w-full p-6 border-2 border-dashed border-purple-400 rounded-lg bg-white cursor-pointer text-center hover:bg-purple-50 transition-colors">
                            <Upload className="w-8 h-8 mx-auto mb-2 text-purple-600" />
                            <p className="font-bold text-purple-700">íŒŒì¼ ì„ íƒ (.docx)</p>
                          </div>
                          <input type="file" accept=".docx" onChange={handleFileUpload} className="hidden" />
                        </label>
                      </div>

                      <div className="border-2 border-green-500 rounded-xl p-4 bg-green-50">
                        <h3 className="text-lg font-black mb-3 text-green-700">ğŸ“¥ ë°±ì—…ì—ì„œ ë³µì›</h3>
                        <label className="block">
                          <div className="w-full p-6 border-2 border-dashed border-green-400 rounded-lg bg-white cursor-pointer text-center hover:bg-green-50 transition-colors">
                            <Upload className="w-8 h-8 mx-auto mb-2 text-green-600" />
                            <p className="font-bold text-green-700">ë°±ì—… íŒŒì¼ ì„ íƒ (.json)</p>
                          </div>
                          <input type="file" accept=".json" onChange={handleRestore} className="hidden" />
                        </label>
                      </div>
                    </div>

                    <button onClick={() => setShowUploadModal(false)} className="w-full mt-4 p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ë‹«ê¸°</button>
                  </div>
                </div>
              )}

              {/* ê²€ìƒ‰ ëª¨ë‹¬ */}
              {showSearchModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-lg max-h-[90vh] flex flex-col shadow-2xl">
                    <h2 className="text-2xl font-black mb-4 text-gray-800">ğŸ” ë§ì”€ ê²€ìƒ‰</h2>
                    
                    <div className="mb-4">
                      <input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="ì¹´ë“œë²ˆí˜¸, ì„±ê²½êµ¬ì ˆ, ë³¸ë¬¸ ë‚´ìš© ê²€ìƒ‰..." className="w-full p-3 border-2 border-teal-300 rounded-xl focus:border-teal-500 focus:outline-none font-bold" />
                    </div>

                    <div className="flex-1 overflow-y-auto search-scroll" style={{ maxHeight: 'calc(85vh - 200px)' }}>
                      {searchQuery.trim() === '' ? (
                        <div className="text-center py-12 text-gray-400 font-bold">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                      ) : searchResults.length === 0 ? (
                        <div className="text-center py-12 text-gray-400 font-bold">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                      ) : (
                        <div className="space-y-3">
                          {searchResults.map(key => {
                            const verse = verses[key];
                            const count = counts[key] || 0;
                            return (
                              <div key={key} onClick={() => { setSelectedCard(key); setShowSearchModal(false); }} className="bg-gradient-to-br from-teal-50 to-blue-50 rounded-2xl p-4 shadow hover:shadow-lg transition-shadow cursor-pointer border-2 border-teal-100">
                                <div className="flex items-center justify-between mb-2">
                                  <div className="flex items-center gap-2">
                                    <span className="font-black text-teal-600 text-lg">{key}</span>
                                    <span className="font-black text-gray-900 text-base">{verse.reference}</span>
                                  </div>
                                  <span className="text-sm font-bold text-teal-600">{count}íšŒ</span>
                                </div>
                                <p className="text-gray-800 font-bold text-sm leading-relaxed">{verse.text}</p>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>

                    <button onClick={() => setShowSearchModal(false)} className="w-full mt-4 p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ë‹«ê¸°</button>
                  </div>
                </div>
              )}

              {/* í†µê³„ ëª¨ë‹¬ */}
              {showStatsModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl w-full max-w-lg flex flex-col shadow-2xl" style={{ height: '85vh', maxHeight: '700px' }}>
                    <div className="p-6 border-b flex-shrink-0">
                      <h2 className="text-2xl font-black text-gray-800">ğŸ“Š ì•”ì†¡ í†µê³„</h2>
                    </div>

                    <div className="flex-1 overflow-y-scroll p-6 stats-scroll">
                      <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 mb-4">
                        <h3 className="font-black text-purple-700 mb-3 text-lg">ğŸ“ˆ ì „ì²´ í˜„í™©</h3>
                        <div className="space-y-2 text-sm font-bold text-gray-700">
                          <div className="flex justify-between"><span>ì´ ì•”ì†¡ íšŸìˆ˜:</span><span className="text-purple-600 text-lg">{stats.totalCount}íšŒ</span></div>
                          <div className="flex justify-between"><span>ì•”ì†¡í•œ ì¹´ë“œ:</span><span className="text-purple-600">{stats.activeCards}ê°œ</span></div>
                          <div className="flex justify-between"><span>ë“±ë¡ëœ ë§ì”€:</span><span className="text-purple-600">{stats.verseCards}ê°œ</span></div>
                        </div>
                      </div>

                      <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 mb-4">
                        <h3 className="font-black text-blue-700 mb-3 text-lg">ğŸ“… ìµœê·¼ 7ì¼ ì•”ì†¡ ê¸°ë¡</h3>
                        <div className="space-y-2">
                          {stats.last7Days.map((day, idx) => {
                            const maxCount = Math.max(...stats.last7Days.map(d => d.count), 1);
                            const width = (day.count / maxCount) * 100;
                            const dateObj = new Date(day.date);
                            const dayName = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][dateObj.getDay()];
                            const dateStr = `${dateObj.getMonth() + 1}/${dateObj.getDate()} (${dayName})`;
                            
                            return (
                              <div key={idx}>
                                <div className="flex justify-between text-xs font-bold text-gray-600 mb-1">
                                  <span>{dateStr}</span>
                                  <span className="text-blue-600">{day.count}íšŒ</span>
                                </div>
                                <div className="bg-gray-200 rounded-full h-6 overflow-hidden">
                                  <div className="bg-gradient-to-r from-blue-400 to-blue-600 h-full rounded-full transition-all duration-500 flex items-center justify-end pr-2" style={{ width: `${width}%` }}>
                                    {day.count > 0 && <span className="text-white text-xs font-black">{day.count}</span>}
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>

                      {stats.mostMemorized.length > 0 && (
                        <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 mb-4">
                          <h3 className="font-black text-green-700 mb-3 text-lg">ğŸ† ê°€ì¥ ë§ì´ ì•”ì†¡í•œ ë§ì”€</h3>
                          <div className="space-y-2">
                            {stats.mostMemorized.map(([key, count], idx) => (
                              <div key={key} onClick={() => { setSelectedCard(key); setShowStatsModal(false); }} className="flex items-center justify-between p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow">
                                <div className="flex items-center gap-3">
                                  <span className="text-2xl">{idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : 'ğŸ…'}</span>
                                  <div>
                                    <div className="font-black text-green-600">{key}</div>
                                    <div className="text-xs font-bold text-gray-600">{verses[key]?.reference}</div>
                                  </div>
                                </div>
                                <span className="font-black text-green-600 text-lg">{count}íšŒ</span>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {stats.leastMemorized.length > 0 && (
                        <div className="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-4 mb-4">
                          <h3 className="font-black text-orange-700 mb-3 text-lg">ğŸ’ª ë” ì•”ì†¡ì´ í•„ìš”í•œ ë§ì”€</h3>
                          <div className="space-y-2">
                            {stats.leastMemorized.map(([key, count]) => (
                              <div key={key} onClick={() => { setSelectedCard(key); setShowStatsModal(false); }} className="flex items-center justify-between p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow">
                                <div className="flex items-center gap-3">
                                  <span className="text-2xl">ğŸ“Œ</span>
                                  <div>
                                    <div className="font-black text-orange-600">{key}</div>
                                    <div className="text-xs font-bold text-gray-600">{verses[key]?.reference}</div>
                                  </div>
                                </div>
                                <span className="font-black text-orange-600 text-lg">{count}íšŒ</span>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>

                    <div className="p-6 border-t flex-shrink-0">
                      <button onClick={() => setShowStatsModal(false)} className="w-full p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ë‹«ê¸°</button>
                    </div>
                  </div>
                </div>
              )}

              {/* í€´ì¦ˆ ëª¨ë‹¬ */}
              {showQuizMode && quizCard && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-lg shadow-2xl">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-2xl font-black text-gray-800">ğŸ¯ í€´ì¦ˆ ëª¨ë“œ</h2>
                      <button onClick={() => setShowQuizMode(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                        <X className="w-6 h-6" />
                      </button>
                    </div>

                    <div className="bg-gradient-to-br from-pink-50 to-purple-50 rounded-2xl p-6 mb-4">
                      <div className="text-center mb-4">
                        <span className="font-black text-pink-600 text-3xl">{quizCard}</span>
                      </div>

                      {!showQuizAnswer ? (
                        <div className="text-center py-8">
                          <p className="text-6xl mb-4">ğŸ¤”</p>
                          <p className="font-black text-gray-700 text-xl mb-2">ì´ ì¹´ë“œì˜ ë§ì”€ì€?</p>
                          <p className="text-gray-500 font-bold">ì•”ì†¡í•´ë³´ì„¸ìš”!</p>
                        </div>
                      ) : (
                        <div>
                          <div className="mb-4">
                            <div className="font-black text-gray-900 text-xl mb-2">{verses[quizCard]?.reference}</div>
                            <div className="font-bold text-gray-800 text-lg leading-relaxed">{verses[quizCard]?.text}</div>
                          </div>
                          <div className="flex items-center justify-center gap-2 text-sm font-bold text-purple-600">
                            <span>ì•”ì†¡ íšŸìˆ˜:</span>
                            <span className="text-2xl">{counts[quizCard] || 0}íšŒ</span>
                          </div>
                        </div>
                      )}
                    </div>

                    <div className="flex gap-3">
                      {!showQuizAnswer ? (
                        <>
                          <button onClick={() => setShowQuizAnswer(true)} className="flex-1 p-4 bg-purple-500 text-white rounded-xl font-bold text-lg hover:bg-purple-600">ì •ë‹µ ë³´ê¸°</button>
                          <button onClick={selectRandomCard} className="p-4 bg-gray-300 rounded-xl hover:bg-gray-400"><Shuffle className="w-6 h-6" /></button>
                        </>
                      ) : (
                        <>
                          <button onClick={() => { incrementCount(quizCard); selectRandomCard(); }} className="flex-1 p-4 bg-green-500 text-white rounded-xl font-bold text-lg hover:bg-green-600">âœ… ë§ì·„ì–´ìš”!</button>
                          <button onClick={selectRandomCard} className="flex-1 p-4 bg-orange-500 text-white rounded-xl font-bold text-lg hover:bg-orange-600">âŒ ë‹¤ìŒ ë¬¸ì œ</button>
                        </>
                      )}
                    </div>

                    <button onClick={() => { setSelectedCard(quizCard); setShowQuizMode(false); }} className="w-full mt-3 p-3 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300">ì´ ì¹´ë“œë¡œ ì´ë™</button>
                  </div>
                </div>
              )}

              {/* ì¹´ìš´í„° ì´ˆê¸°í™” ëª¨ë‹¬ */}
              {showResetCountModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl">
                    <h2 className="text-2xl font-black mb-4 text-gray-800">ğŸ”„ ì•”ì†¡ ê¸°ë¡ ì´ˆê¸°í™”</h2>
                    <p className="text-gray-600 font-bold mb-6 text-sm">ì´ˆê¸°í™”í•  ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                    
                    <div className="space-y-3 mb-4">
                      {(() => {
                        const zeroCards = Object.keys(verses).filter(key => key.match(/^0\d+$/));
                        if (zeroCards.length > 0) {
                          return (
                            <button onClick={() => resetCounters('0')} className="w-full p-4 bg-gradient-to-r from-blue-400 to-blue-500 text-white rounded-xl font-bold text-left hover:from-blue-500 hover:to-blue-600 transition-all">
                              <div className="text-lg">0XX ê·¸ë£¹ ì´ˆê¸°í™”</div>
                              <div className="text-xs mt-1 opacity-90">ìˆ«ì ì¹´ë“œ ({zeroCards.length}ê°œ)ì˜ ì•”ì†¡ ê¸°ë¡ ì´ˆê¸°í™”</div>
                            </button>
                          );
                        }
                        return null;
                      })()}
                      
                      {['A', 'B', 'C', 'D', 'E'].map(letter => {
                        const letterCards = Object.keys(verses).filter(key => key.startsWith(letter));
                        if (letterCards.length === 0) return null;
                        
                        return (
                          <button key={letter} onClick={() => resetCounters(letter)} className="w-full p-4 bg-gradient-to-r from-orange-400 to-orange-500 text-white rounded-xl font-bold text-left hover:from-orange-500 hover:to-orange-600 transition-all">
                            <div className="text-lg">{letter} ê·¸ë£¹ ì´ˆê¸°í™”</div>
                            <div className="text-xs mt-1 opacity-90">{letter} ì¹´ë“œ ({letterCards.length}ê°œ)ì˜ ì•”ì†¡ ê¸°ë¡ ì´ˆê¸°í™”</div>
                          </button>
                        );
                      })}
                      
                      <button onClick={() => resetCounters('all')} className="w-full p-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-bold text-left hover:from-red-600 hover:to-red-700 transition-all">
                        <div className="text-lg">ì „ì²´ ê¸°ë¡ ì´ˆê¸°í™”</div>
                        <div className="text-xs mt-1 opacity-90">ëª¨ë“  ì¹´ë“œì˜ ì•”ì†¡ ê¸°ë¡ ë° ì¼ì¼ í†µê³„ ì´ˆê¸°í™”</div>
                      </button>
                    </div>

                    <button onClick={() => setShowResetCountModal(false)} className="w-full p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ì·¨ì†Œ</button>
                  </div>
                </div>
              )}

              {/* ì „ì²´ ì¹´ìš´í„° ë³´ê¸° ëª¨ë‹¬ */}
              {showAllCounts && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl w-full max-w-lg flex flex-col shadow-2xl" style={{ height: '85vh', maxHeight: '700px' }}>
                    <div className="p-6 border-b flex-shrink-0">
                      <h2 className="text-2xl font-black text-gray-800">ğŸ“Š ì „ì²´ ì•”ì†¡ ê¸°ë¡</h2>
                    </div>
                    
                    <div className="flex-1 overflow-y-scroll p-6 scroll-container">
                      {(() => {
                        const zeroCards = Object.keys(verses).filter(key => key.match(/^0\d+$/)).sort();
                        if (zeroCards.length > 0) {
                          return (
                            <div className="mb-6">
                              <h3 className="text-lg font-black text-purple-600 mb-2 bg-white py-2">0XX ê·¸ë£¹ (ìˆ«ì) - {zeroCards.length}ê°œ</h3>
                              <div className="grid grid-cols-6 gap-2">
                                {zeroCards.map(key => {
                                  const count = counts[key] || 0;
                                  const hasVerse = verses[key]?.reference && verses[key]?.text;
                                  const char = getCharacter(count);
                                  return (
                                    <button key={key} onClick={() => { setSelectedCard(key); setShowAllCounts(false); }} className={`p-3 rounded-xl font-bold text-sm shadow transition-all ${hasVerse ? 'bg-gradient-to-br from-purple-100 to-pink-100 hover:shadow-lg' : 'bg-gray-100 hover:bg-gray-200'}`}>
                                      <div className="text-xs font-black text-gray-600">{key}</div>
                                      <div className="text-lg font-black text-purple-600">{count}</div>
                                      <div className="text-xs">{char.emoji}</div>
                                    </button>
                                  );
                                })}
                              </div>
                            </div>
                          );
                        }
                        return null;
                      })()}
                      
                      {['A', 'B', 'C', 'D', 'E'].map(letter => {
                        const letterCards = Object.keys(verses).filter(key => key.startsWith(letter)).sort();
                        if (letterCards.length === 0) return null;
                        
                        return (
                          <div key={letter} className="mb-6">
                            <h3 className="text-lg font-black text-purple-600 mb-2 bg-white py-2">{letter} ê·¸ë£¹ - {letterCards.length}ê°œ</h3>
                            <div className="grid grid-cols-6 gap-2">
                              {letterCards.map(key => {
                                const count = counts[key] || 0;
                                const hasVerse = verses[key]?.reference && verses[key]?.text;
                                const char = getCharacter(count);
                                return (
                                  <button key={key} onClick={() => { setSelectedCard(key); setShowAllCounts(false); }} className={`p-3 rounded-xl font-bold text-sm shadow transition-all ${hasVerse ? 'bg-gradient-to-br from-purple-100 to-pink-100 hover:shadow-lg' : 'bg-gray-100 hover:bg-gray-200'}`}>
                                    <div className="text-xs font-black text-gray-600">{key}</div>
                                    <div className="text-lg font-black text-purple-600">{count}</div>
                                    <div className="text-xs">{char.emoji}</div>
                                  </button>
                                );
                              })}
                            </div>
                          </div>
                        );
                      })}
                    </div>

                    <div className="p-6 border-t flex-shrink-0">
                      <button onClick={() => setShowAllCounts(false)} className="w-full p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ë‹«ê¸°</button>
                    </div>
                  </div>
                </div>
              )}

              {/* ë§ì”€ ëª©ë¡ ë³´ê¸° ëª¨ë‹¬ */}
              {showAllVerses && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl w-full max-w-2xl flex flex-col shadow-2xl" style={{ height: '85vh', maxHeight: '700px' }}>
                    <div className="p-6 border-b flex-shrink-0">
                      <h2 className="text-2xl font-black text-gray-800">ğŸ“– ì „ì²´ ë§ì”€ ëª©ë¡</h2>
                    </div>
                    
                    <div className="flex-1 overflow-y-scroll p-6 verse-scroll">
                      <div className="space-y-3">
                        {Object.keys(verses).sort().filter(key => {
                          const verse = verses[key];
                          return verse.reference && verse.text;
                        }).map(key => {
                          const verse = verses[key];
                          const count = counts[key] || 0;
                          const char = getCharacter(count);
                          
                          return (
                            <div key={key} onClick={() => { setSelectedCard(key); setShowAllVerses(false); }} className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-4 shadow hover:shadow-lg transition-shadow cursor-pointer border-2 border-purple-100">
                              <div className="flex items-center justify-between mb-2">
                                <div className="flex items-center gap-2">
                                  <span className="font-black text-purple-600 text-lg">{key}</span>
                                  <span className="font-black text-gray-900 text-base">{verse.reference}</span>
                                </div>
                                <div className="flex items-center gap-2">
                                  <span className="text-sm font-bold text-purple-600">{count}íšŒ</span>
                                  <span className="text-lg">{char.emoji}</span>
                                </div>
                              </div>
                              <p className="text-gray-800 font-bold text-sm leading-relaxed" style={{ wordBreak: 'keep-all' }}>{verse.text}</p>
                            </div>
                          );
                        })}

                        {Object.keys(verses).filter(k => verses[k].reference && verses[k].text).length === 0 && (
                          <div className="text-center py-12">
                            <p className="text-gray-400 font-bold text-lg mb-4">ë“±ë¡ëœ ë§ì”€ì´ ì—†ìŠµë‹ˆë‹¤</p>
                            <button onClick={() => { setShowAllVerses(false); setShowUploadModal(true); }} className="px-6 py-3 bg-purple-500 text-white rounded-xl font-bold">ë§ì”€ ì¶”ê°€í•˜ê¸°</button>
                          </div>
                        )}
                      </div>
                    </div>

                    <div className="p-6 border-t flex-shrink-0">
                      <button onClick={() => setShowAllVerses(false)} className="w-full p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ë‹«ê¸°</button>
                    </div>
                  </div>
                </div>
              )}

              {/* ì‚­ì œ ë©”ë‰´ ëª¨ë‹¬ */}
              {showDeleteMenu && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl">
                    <h2 className="text-2xl font-black mb-4 text-gray-800">ğŸ—‘ï¸ ì‚­ì œ ë©”ë‰´</h2>
                    <p className="text-gray-600 font-bold mb-6 text-sm">ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”</p>
                    
                    <div className="space-y-3">
                      <button onClick={() => { setShowDeleteMenu(false); setShowDeleteConfirm(true); }} className="w-full p-4 bg-orange-500 text-white rounded-xl font-bold text-left hover:bg-orange-600 transition-colors">
                        <div className="text-lg">ê°œë³„ ì‚­ì œ</div>
                        <div className="text-xs mt-1 opacity-90">{selectedCard} - {currentCard?.reference || '(ë¹ˆ ì¹´ë“œ)'} ì‚­ì œ</div>
                      </button>

                      <button onClick={() => { setShowDeleteMenu(false); setShowMultiDeleteModal(true); }} className="w-full p-4 bg-red-500 text-white rounded-xl font-bold text-left hover:bg-red-600 transition-colors">
                        <div className="text-lg">ì„ íƒ ì‚­ì œ</div>
                        <div className="text-xs mt-1 opacity-90">ì—¬ëŸ¬ ì¹´ë“œë¥¼ ì„ íƒí•´ì„œ ì‚­ì œí•©ë‹ˆë‹¤</div>
                      </button>
                    </div>

                    <button onClick={() => setShowDeleteMenu(false)} className="w-full mt-4 p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ì·¨ì†Œ</button>
                  </div>
                </div>
              )}

              {/* ì‚­ì œ í™•ì¸ ëª¨ë‹¬ */}
              {showDeleteConfirm && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl">
                    <h2 className="text-2xl font-black mb-4 text-gray-800">âš ï¸ ì‚­ì œ í™•ì¸</h2>
                    
                    <p className="text-gray-700 font-bold mb-2">
                      <span className="text-purple-600">{selectedCard}</span> ì¹´ë“œë¥¼ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                    </p>
                    {currentCard?.reference && <p className="text-sm text-gray-600 font-bold mb-4">{currentCard.reference}</p>}
                    <p className="text-sm text-red-600 font-bold mb-6">âš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    <div className="flex gap-3">
                      <button onClick={() => setShowDeleteConfirm(false)} className="flex-1 p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ì·¨ì†Œ</button>
                      <button onClick={handleDeleteCard} className="flex-1 p-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">ì‚­ì œ</button>
                    </div>
                  </div>
                </div>
              )}

              {/* ì„ íƒ ì‚­ì œ ëª¨ë‹¬ */}
              {showMultiDeleteModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-3xl w-full max-w-2xl flex flex-col shadow-2xl" style={{ height: '85vh', maxHeight: '700px' }}>
                    <div className="p-6 border-b flex-shrink-0">
                      <h2 className="text-2xl font-black text-gray-800">âœ… ì„ íƒ ì‚­ì œ</h2>
                      <p className="text-sm text-gray-600 font-bold mt-2">ì‚­ì œí•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                    </div>
                    
                    <div className="p-4 border-b flex-shrink-0 bg-gray-50">
                      <div className="flex gap-2">
                        <button onClick={selectAllCards} className="flex-1 p-2 bg-blue-500 text-white rounded-lg font-bold text-sm hover:bg-blue-600">ì „ì²´ ì„ íƒ</button>
                        <button onClick={deselectAllCards} className="flex-1 p-2 bg-gray-400 text-white rounded-lg font-bold text-sm hover:bg-gray-500">ì„ íƒ í•´ì œ</button>
                      </div>
                      <div className="mt-2 text-center">
                        <span className="text-sm font-black text-purple-600">{selectedForDelete.length}ê°œ ì„ íƒë¨</span>
                      </div>
                    </div>
                    
                    <div className="flex-1 overflow-y-scroll p-6 delete-scroll">
                      <div className="space-y-2">
                        {Object.keys(verses).sort().map(key => {
                          const verse = verses[key];
                          const isSelected = selectedForDelete.includes(key);
                          const count = counts[key] || 0;
                          
                          return (
                            <div key={key} onClick={() => toggleCardSelection(key)} className={`p-4 rounded-xl cursor-pointer transition-all border-2 ${isSelected ? 'bg-red-100 border-red-400' : 'bg-white border-gray-200 hover:border-purple-300'}`}>
                              <div className="flex items-center gap-3">
                                <div className={`w-6 h-6 rounded border-2 flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-red-500 border-red-500' : 'bg-white border-gray-400'}`}>
                                  {isSelected && <span className="text-white text-sm">âœ“</span>}
                                </div>
                                <div className="flex-1 min-w-0">
                                  <div className="flex items-center gap-2 mb-1">
                                    <span className="font-black text-purple-600">{key}</span>
                                    {verse.reference && <span className="font-bold text-gray-700 text-sm truncate">{verse.reference}</span>}
                                  </div>
                                  {verse.text && <p className="text-xs text-gray-600 font-bold truncate">{verse.text}</p>}
                                </div>
                                <span className="text-xs font-bold text-purple-600 flex-shrink-0">{count}íšŒ</span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>

                    <div className="p-6 border-t flex-shrink-0">
                      <div className="flex gap-3">
                        <button onClick={() => { setShowMultiDeleteModal(false); setSelectedForDelete([]); }} className="flex-1 p-3 bg-gray-300 text-gray-700 rounded-xl font-bold">ì·¨ì†Œ</button>
                        <button onClick={handleDeleteSelectedCards} disabled={selectedForDelete.length === 0} className="flex-1 p-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed">{selectedForDelete.length}ê°œ ì‚­ì œ</button>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<BibleMemoryCards />);
  </script>
</body>
</html>
